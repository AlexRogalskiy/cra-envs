#!/usr/bin/env node

import { join as pathJoin, basename as pathBasename } from "path";
import { getEnvNames } from "./getEnvNames";
import * as fs from "fs";
import { getProjectRoot } from "../tools/getProjectRoot";

const targetProjectDirPath = process.cwd();

fs.writeFileSync(
    pathJoin(targetProjectDirPath, "src", "env.ts"),
    Buffer.from(
        [
            `// Generated by ${pathBasename(__filename).split(".")[0]}. Not meant to be edited manually`,
            `import { getEnvVarName } from "${require(pathJoin(getProjectRoot(), "package.json"))["name"]}";`,
            '',
            'export function getEnv() {',
            '    return {',
            getEnvNames({ targetProjectDirPath })
                .map(envName => `        "${envName}": getEnvVarName("${envName}")`)
                .join(",\n"),
            '    } as const;',
            '}',
            ''
        ].join("\n"),
        "utf8"
    )
);






